<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8" />
  <title>Heterogeneous Computing</title>
  <meta name="description" content="Programming Heterogeneous Arquitectures using Data Parallel C&#43;&#43;" />
  <meta name="author" content="Joel Fuentes" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="generator" content="kitab theme by Darshan in Hugo 0.96.0" />

  <link
    rel="stylesheet"
    href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
    crossorigin="anonymous"
  />
  <link
    href="https://fonts.googleapis.com/css?family=Roboto&display=swap"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
    integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay"
    crossorigin="anonymous"
  />
  <link rel="stylesheet" href="/~jfuentes/classes/hc/css/kitab.css" />

  <script src="/~jfuentes/classes/hc/js/myFunctions.js"></script>
  <script src="/~jfuentes/classes/hc/js/clipboard.min.js"></script>

    
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

  <body class="container" style="max-width: 1024px;">
    <nav class="mt-2 border-bottom">
  <div class="d-flex flex-row position-relative">
    <a href="/~jfuentes/classes/hc/"
      ><i title="Home" class="nav-menu mr-2 mt-1 fas fa-home"></i
    ></a>
    <div class="position-relative">
  <i
    class="nav-menu hover-menu ml-2 mr-2 mt-1 fas fa-book"
    onclick="expandMenu(this)"
    title="Show all units"
  ></i>
  <div
    class="show bg-light shadow mt-2"
    style="position: absolute;
      min-width: 280px;
      max-width: 75%;
      z-index: 1;
      max-height: 0px;
      overflow: hidden;"
  >
    <div class="p-2">
      <strong>
        Units
      </strong>
      <ul class="list-unstyled ml-1">
        
        <li class="hanging">
          <a href="http://www.face.ubiobio.cl/~jfuentes/classes/hc/unit1/">
            <ol>
<li>Architectures</li>
</ol>

          </a>
          by 6 sessions
        </li>
        
        <li class="hanging">
          <a href="http://www.face.ubiobio.cl/~jfuentes/classes/hc/unit2/">
            <ol start="2">
<li>Programming Models</li>
</ol>

          </a>
          by 10 sessions
        </li>
        
        <li class="hanging">
          <a href="http://www.face.ubiobio.cl/~jfuentes/classes/hc/unit3/">
            <ol start="3">
<li>Algorithms</li>
</ol>

          </a>
          by 6 sessions
        </li>
        
        <li class="hanging">
          <a href="http://www.face.ubiobio.cl/~jfuentes/classes/hc/unit4/">
            <ol start="4">
<li>Performance</li>
</ol>

          </a>
          by 3 sessions
        </li>
        
      </ul>
    </div>
  </div>
</div>

    
    <div class="position-relative">
  <i
    class="nav-menu hover-menu ml-2 mr-2 mt-1 fas fa-bars"
    onclick="expandMenu(this)"
    title = "Show Sessions"
  ></i>
  <div
    class="show bg-light shadow mt-2"
    style="
      position: absolute;
      min-width: 280px;
      max-width: 75%;
      z-index: 1;
      max-height: 0px;
      overflow: hidden;"
  >
    <div class="p-2 rounded">
      <strong class="mt-3">
        
        
        <ol start="2">
<li>Programming Models</li>
</ol>

        
      </strong>
      <ul class="list-unstyled ml-1">
        
        
        <li class="hanging">
          <a href="http://www.face.ubiobio.cl/~jfuentes/classes/hc/unit2/dpcpp/">DPC++</a>
        </li>
        
        <li class="hanging">
          <a href="http://www.face.ubiobio.cl/~jfuentes/classes/hc/unit2/lab1/">Lab 1</a>
        </li>
        
        <li class="hanging">
          <a href="http://www.face.ubiobio.cl/~jfuentes/classes/hc/unit2/compute_models/">Compute Models</a>
        </li>
        
        <li class="hanging">
          <a href="http://www.face.ubiobio.cl/~jfuentes/classes/hc/unit2/project/">Project</a>
        </li>
        
        <li class="hanging">
          <a href="http://www.face.ubiobio.cl/~jfuentes/classes/hc/unit2/devcloud/">DevCloud</a>
        </li>
        
        <li class="hanging">
          <a href="http://www.face.ubiobio.cl/~jfuentes/classes/hc/unit2/frameworks/">Programming Frameworks</a>
        </li>
        
        <li class="hanging">
          <a href="http://www.face.ubiobio.cl/~jfuentes/classes/hc/unit2/oneapi/">Intro to OneAPI and DPC++</a>
        </li>
        
        <li class="hanging">
          <a href="http://www.face.ubiobio.cl/~jfuentes/classes/hc/unit2/evaluation/">Test 2</a>
        </li>
        
        <li class="hanging">
          <a href="http://www.face.ubiobio.cl/~jfuentes/classes/hc/unit2/gpu/">GPU Computing (invited talk)</a>
        </li>
        
      </ul>
    </div>
  </div>
</div>

    
  </div>
</nav>

    <main class="mt-3" style="margin-left: 32px;">
      
<div class="mb-2 p-3 shadow position-relative">
  <small
    class="bg-white pl-1 pr-1 rounded"
    style="background-color: #f3f3ef !important; position: absolute; top: -0.75em; right: 1em"
  ><div>
  






<span style="font-size: 0.9em;"><i
    aria-label="home"
    class="fas fa-home"
  ></i
  ></span>



<span style="font-size: 0.9em;"> / <ol start="2">
<li>Programming â€¦</li></ol></span>



<span style="font-size: 0.9em;"> / Project</span>

</div>


</small>
  <h2>Project</h2>
  <div class="rounded">
    <h2 id="heat-propagation-in-metals">Heat propagation in metals</h2>
<p>Laplace&rsquo;s equation is a second-order partial differential equation used to solve problems in multiple branches of science such as electrostatics, fluid dynamics, heat conduction, etc.</p>
<p>In its most basic form it can be expressed as follows:
$$\nabla^2f(x,y)=0 $$</p>
<p>In particular, to solve propagation and simulation problems, the Jacobi iteration is proposed. This iteration establishes that the Laplace equation is applied in a matrix of points, with each point being an average of its adjacent points. Consequently, it is possible to converge to a state by iteratively computing new values for each point in the matrix using the average of the adjacent points. The following image shows the calculation of a given point using the adjacent point&rsquo;s value in each Jacobi iteration:</p>
<p align="center">
  <img src="../../images/neighbors.png">
</p>
<p>$$A_{k+1}(i,j)=\frac{A_k(i-1,j)+A_k(i+1,j)+A_k(i,j-1)+A_k(i,j+1)}{4} $$</p>
<p>This way, to calculate the value \(A(i, j)\) of the iteration \(k+1\), the average value of its adjacent points is calculated from the iteration \(k\).</p>
<p>In this project, you must implement a simulator of heat propagation in metals. Suppose that there exists a metal of given dimensions to which a heat source is applied at one of its ends. As time passes, the heat begins to spread through the metal until it reaches a stable final state. This behavior can be modeled using Jacobi iterations and the Laplace equation described above. The following figure shows a graphic representation of the initial state of a metal plate and the stable final state after the heat has fully propagated.</p>
<p align="center">
  <img src="../../images/metal-en.png">
</p>
<p>The metal plate can be computationally modeled by using a matrix of values that indicate the temperature of each of its points. However, the calculation to perform the heat propagation simulation will take a relatively long time to compute sequentially, since hundred of iterations must be performed with the calculation of the average of the adjacent points. Because of this, you are required to implement a parallel solution using DPC++.</p>
<p>The main calculation used to compute the simulation is given by the following sequential code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Iterate until reaching a stabilized state or maximum number of iterations
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">while</span> ( dt <span style="color:#f92672">&gt;</span> MAX_TEMP_ERROR <span style="color:#f92672">&amp;&amp;</span> iteration <span style="color:#f92672">&lt;=</span> max_iterations ) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Main calculation:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// For each position of the matrix calculate the average of the neighbors
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> ROWS; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span>(j <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; j <span style="color:#f92672">&lt;=</span> COLUMNS; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                Temperature[i][j] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.25</span> <span style="color:#f92672">*</span> (Temperature_last[i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>][j] <span style="color:#f92672">+</span> Temperature_last[i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][j] <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>                                            Temperature_last[i][j<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> Temperature_last[i][j<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        dt <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>; <span style="color:#75715e">// Reset largest temperature difference
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Copy matrix and find the maximum heat difference
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span>(i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; i <span style="color:#f92672">&lt;=</span> ROWS; i<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span>(j <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; j <span style="color:#f92672">&lt;=</span> COLUMNS; j<span style="color:#f92672">++</span>){
</span></span><span style="display:flex;"><span>	            dt <span style="color:#f92672">=</span> fmax( fabs(Temperature[i][j]<span style="color:#f92672">-</span>Temperature_last[i][j]), dt);
</span></span><span style="display:flex;"><span>	            Temperature_last[i][j] <span style="color:#f92672">=</span> Temperature[i][j];
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span></code></pre></div><p>The <code>while</code> loop controls the end of the Jacobi iteration, and it will continue iterating as long as a heat stability level is not reached <code>(dt&gt; MAX_TEMP_ERROR)</code> and the maximum number of iterations is not reached <code>(iteration &lt;= max_iterations)</code>. The internal <code>for</code> structures correspond to calculations that must be parallelized. The first nested <code>for</code> computes the average of the adjacent points for each position in the array, and the second nested <code>for</code> copies the newly computed values between arrays and finds the maximum heat difference between the previous and current iteration. Note that when parallelizing the search for the maximum heat change in the second nested <code>for</code>, all threads must update the <code>dt</code> variable, so it is necessary to use some reduction and/or synchronization technique.</p>
<p>Your implementation must use techniques available in DPC++ to speed up the processing on Multi-core CPUs, GPUs, or FPGAs. To achieve this consider the following:</p>
<ol>
<li>Buffer declarations for data storage.</li>
<li>Parallelize the process by using <code>parallel_for</code>, <code>range</code>, and <code>nd_range</code>.</li>
<li>Data synchronization in data shared by multiple threads.</li>
</ol>
<h2 id="implementation-and-submissions">Implementation and Submissions</h2>
<ul>
<li>This project can be done in teams of at most two members.</li>
<li>The submission is to be uploaded using Github Classroom.</li>
<li>The initial code includes a sequential version of the problem. The solution must be implemented inside the <code>laplace_parallel</code> function using DPC++.</li>
<li>The implementation must consider two main goals:
<ul>
<li>The calculation of the temperature difference must be correct.</li>
<li>The implementation must be more efficient performance-wise than the sequential implementation. The performance is measured using the execution time of the simulations.</li>
</ul>
</li>
<li>When evaluating submissions, a ranking will be made sorted by the most efficient implementations. - This will be considered to mark the final grade.</li>
<li>Submission dates:
<ul>
<li>First submission:
<ul>
<li>Simulation implementation using DPC++ working properly.</li>
<li>Tuesday 11:59 PM, November 30th, 2021.</li>
</ul>
</li>
<li>Final submission:
<ul>
<li>Simulation implementation using DPC++ working properly with performance improvements.</li>
<li>Thursday 11:59 PM, December 23rd, 2021.</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<p>Reference: Problem adapted from John Urbanic&rsquo;s materials.</p>

  </div>
</div>

    </main>
    <div class="side-bar">
  
  <p class="mb-1 mt-1 text-left">
  
  <a
    href="/~jfuentes/classes/hc/unit2/devcloud/"
    title="DevCloud"
  >
    <i class="nav-menu fas fa-chevron-circle-right"></i>
  </a>
  
</p>
<p class="mb-1 mt-1 text-left">
  
  <a
    href="/~jfuentes/classes/hc/unit2/compute_models/"
    title="Compute Models"
  >
    <i class="nav-menu fas fa-chevron-circle-left"></i>
  </a>
  
</p>

  
  <a href="#" class="mb-1 mt-1 text-left">
    <i
      class="nav-menu fas fa-chevron-circle-up"
      aria-label="Scroll to top"
    ></i>
  </a>
  <p class="mb-1 mt-1 text-left">
    <i
      title="Copy URL to share"
      class="nav-menu fas fa-share-alt"
    ></i>
  </p>
</div>

<script>
  function displayCopyMessage(bool) {
    let alertMessage = "";
    if (bool) {
      alertMessage = "Link copied to clipboard";
    } else {
      alertMessage = "Link could not be copied to clipboard";
    }
    let copiedMessage = document.createElement("div");
    copiedMessage.id = "copiedMessage";
    copiedMessage.textContent = alertMessage;
    copiedMessage.classList.add(
      "bg-warning",
      "shadow",
      "d-block",
      "text-center"
    );
    document.body.appendChild(copiedMessage);

    setTimeout(function() {
      copiedMessage.style.opacity = 0;
    }, 500);
    setTimeout(function() {
      document.body.removeChild(copiedMessage);
    }, 1500);
  }

  let clipboard = new ClipboardJS(".fa-share-alt", {
    text: function() {
      return "http:\/\/www.face.ubiobio.cl\/~jfuentes\/classes\/hc\/unit2\/project\/";
    }
  });

  clipboard.on("success", function() {
    displayCopyMessage(true);
  });

  clipboard.on("error", function() {
    displayCopyMessage(false);
  });
</script>

    <footer class="d-flex flex-row flex-wrap justify-content-between">
  <div class="d-flex flex-column">
    <span class="mb-1">
      Universidad del BÃ­o-BÃ­o, Chile
      &middot;
      2021
    </span>
  </div>

    <div class="row">
      <div class="column" style="
      width: 100%;">Sponsors:</div>
      <div class="column" style="
      width: 120px;
      margin-left: 65px;"><img src="http://www.face.ubiobio.cl/~jfuentes/classes/hc/images/ici_web.png" height="40%" ></div>
      <div class="column" style="
      width: 120px;
      margin-left: 10px;"><img src="http://www.face.ubiobio.cl/~jfuentes/classes/hc/images/intel_web.png" height="20%" ></div>
    </div> 

  </footer>

  </body>
</html>
